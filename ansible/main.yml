---
- hosts: "all"
  remote_user: "ansible"
  become: true
  become_user: "root"
  become_method: "sudo"
  force_handlers: true

  handlers:
    - import_tasks: "handlers/main.yml"

  roles:
    - role: "common"
      tags: "always"
    - role: "packages"
      tags: "packages"
    - role: "databases"
      tags: "databases"
    - role: "auth"
      tags: "auth"
    - role: "users"
      tags: "users"
    - role: "monitoring"
      tags: "monitoring"
    - role: "firewall"
      tags: "firewall"
    - role: "backups"
      tags: "backups"
    - role: "redis"
      tags: "redis"
    - role: "nginx"
      tags: "nginx"
    - role: "php"
      tags: "php"
    - role: "websites"
      tags: "websites"
    - role: "certbot"
      tags: "certbot"
    - role: "digidecs"
      tags: "digidecs"
    - role: "freight"
      tags: "freight"
    - role: "aas"
      tags: "aas"
    - role: "static-sticky"
      tags: "static"
    - role: "pretix"
      tags: "pretix"
    - role: "nix"
      tags: "nix"
    - role: "koala"
      tags: "koala"
    - role: "oauth2_proxy"
      tags: "oauth"
    - role: "outline"
      tags: "outline"
    - role: "execut"
      tags: "execut"
    - role: "radio"
      tags: "radio"
    - role: "sodi"
      tags: "sodi"
    - role: "public_files"
      tags: "public"
    - role: "files_website"
      tags: "files"
    # We only want to deploy the crazy88 role when specifically requested
    - role: "crazy88bot"
      tags: ["never", "crazy88bot"]
    - role: "doorgeefluik"
      tags: "doorgeefluik"
    # Included the last, so any service that fail2ban is applied to, already
    # exists. Otherwise fail2ban would miss the log files it has to monitor.
    - role: "fail2ban"
      tags: "always"
