---
- hosts: development
  user: ansible
  become: yes
  become_user: root
  become_method: sudo
  vars_files:
    - vars.yml

  handlers:
    - name: "restart nginx"
      service:
        name: nginx
        state: restarted

    - name: "reload nginx"
      service:
        name: nginx
        state: reloaded

    - name: "restart ssh"
      service:
        name: ssh
        state: restarted

    - name: "restart fail2ban"
      service:
        name: fail2ban
        state: restarted

    - name: "systemctl daemon-reload"
      command: systemctl daemon-reload
      become: yes

  tasks:
    - include: tasks/users.yml
    - include: tasks/auth.yml
    - include: tasks/locale.yml
    - include: tasks/packages.yml
    - include: tasks/fail2ban.yml
    - include: tasks/nginx.yml
    - include: tasks/firewall.yml
    - include: tasks/monitoring.yml
    - include: tasks/database.yml
    - include: tasks/koala.yml
    - include: tasks/studystatus.yml
