#!/usr/bin/env bash

# {{ ansible_managed }}

# get latest version of website sourcecode
cd /var/www/static-sticky/static-sticky
git reset --hard HEAD
git pull

# install npm packages
. /var/www/static-sticky/.nvm/nvm.sh
npm install

# build website
npm run build

# copy website contents to webroot
rsync --delete --recursive \
    /var/www/static-sticky/static-sticky/public/ \
    /var/www/static-sticky/static.{{ canonical_hostname }}/
