---
canonical_hostname: "{{ inventory_hostname }}"
server_hostname: "sadserver"

secrets_environment_directory:
  "{% if staging == 'true' %}staging{% else %}production{% endif %}"

# This is also used for the root user, but the "$" at the end is replaced by a
# "#" through a regex in tasks/users.yml.
bash_prompt:
  "export PS1='\\n\\e[31m\\e[1m{% if staging == 'true' %}STAGING{% else %}!! \
  PRODUCTION !!{% endif %}\\e[0m \\e[33m\\e[1m`whoami`@`hostname --long`\
  \\e[0m:`pwd`\\n$ '"

tmp_dir: "/tmp"

# When editing keys, be sure to read ../docs/updating-ssh-keys.md first!
# When adding admin users, be sure to add their keys to the "ansible" user too!
users:
  - name: "ansible"
    admin: true
    home_prefix: "/home"
    state: "present"
    keys:
      - id: "arianvp.github.pub"
        state: "present"
      - id: "duijf.github.pub"
        state: "present"
      - id: "maartenberg.github.pub"
        state: "present"
      - id: "RobinSikkens.github.pub"
        state: "present"
      - id: "romanpeters.github.pub"
        state: "present"
      - id: "tomwassenberg.github.pub"
        state: "present"

  - name: "arian"
    admin: true
    home_prefix: "/home"
    state: "present"
    keys:
      - id: "arianvp.github.pub"
        state: "present"

  - name: "emiel"
    admin: true
    home_prefix: "/home"
    state: "present"
    keys:
      - id: "emielvanrijn.github.pub"
        state: "present"

  - name: "laurens"
    admin: true
    home_prefix: "/home"
    state: "present"
    keys:
      - id: "duijf.github.pub"
        state: "present"

  - name: "maarten"
    admin: true
    home_prefix: "/home"
    state: "present"
    keys:
      - id: "maartenberg.github.pub"
        state: "present"

  - name: "robin"
    admin: true
    home_prefix: "/home"
    state: "present"
    keys:
      - id: "RobinSikkens.github.pub"
        state: "present"

  - name: "roman"
    admin: true
    home_prefix: "/home"
    state: "present"
    keys:
      - id: "romanpeters.github.pub"
        state: "present"

  - name: "tom"
    admin: true
    home_prefix: "/home"
    state: "present"
    keys:
      - id: "tomwassenberg.github.pub"
        state: "present"

  - name: "bestuur"
    admin: false
    home_prefix: "/var/www"
    state: "present"
    keys:
      - id: "emielvanrijn.github.pub"
        state: "present"

  - name: "commit"
    admin: false
    home_prefix: "/var/www"
    state: "present"
    keys:
      - id: "cdfa.github.pub"
        state: "present"
      - id: "emielvanrijn.github.pub"
        state: "present"
      - id: "GlennStewart125.github.pub"
        state: "present"
      - id: "Agarwaemben.github.pub"
        state: "present"
      - id: "maartenberg.github.pub"
        state: "present"
      #- id: "raatmarien.github.pub" # Currently no keys
        #state: "present"
      - id: "ebilkill.github.pub"
        state: "present"

  - name: "dgdarc"
    admin: false
    home_prefix: "/var/www"
    state: "present"
    keys: []

  - name: "indievelopment"
    admin: false
    home_prefix: "/var/www"
    state: "present"
    keys:
      - id: "RCdeWit.github.pub"
        state: "present"

  - name: "stichting"
    admin: false
    home_prefix: "/var/www"
    state: "present"
    keys:
      - id: "RCdeWit.github.pub"
        state: "present"

  - name: "studytrip"
    admin: false
    home_prefix: "/var/www"
    state: "present"
    keys:
      - id: "Rogions.github.pub"
        state: "present"

  - name: "symposium"
    admin: false
    home_prefix: "/var/www"
    state: "present"
    keys:
      - id: "emielvanrijn.github.pub"
        state: "present"
      - id: "duijf.github.pub"
        state: "present"
      - id: "RCdeWit.github.pub"
        state: "present"

  - name: "wintersport"
    admin: false
    home_prefix: "/var/www"
    state: "present"
    keys: []

unattended_upgrades:
  security: true
  all: true

fail2ban:
  loglevel: "WARNING"
  ignoreip: "127.0.0.1/8 131.211.42.201"
  bantime: 600
  maxretry: 6
  banaction: "iptables-multiport"

  services:
    - name: "sshd"
      port: "ssh"
      filter: "sshd"
      logpath: "/var/log/auth.log"
    - name: "pma"
      port: "https"
      filter: "phpmyadmin-syslog"
      logpath: "/var/log/auth.log"
    - name: "koala"
      port: "https"
      filter: "koala"
      logpath: "/var/www/koala.{{ canonical_hostname }}/log/{{ koala.environment }}.log"
      maxretry: 10

# the upload limit for php-fpm and nginx in megabytes
upload_limit: 30

# Defines our websites. Important to note is that the "name" of a website should
# always be a subdomain of the canonical hostname (using the
# "canonical_hostname" variable). This has to do with the current state of our
# DNS zones, and ensures that TLS certificates are set up correctly in the
# staging environment. This could be improved perhaps.
websites:
  - name: "dgdarc.{{ canonical_hostname }}"
    user: "dgdarc"
    database: "dgdarc"
    alternative_names:
      - "dgdarc.nl"
      - "www.dgdarc.nl"
      - "dgdarc.com"
      - "www.dgdarc.com"
    state: "present"

  - name: "digidecs.{{ canonical_hostname }}"
    user: "commit"
    alternative_names:
      - "declaraties.{{ canonical_hostname }}"
      - "declareren.{{ canonical_hostname }}"
    # You have to remove the task include of digidecs.yml to remove this
    # completely
    state: "present"

  - name: "indievelopment.{{ canonical_hostname }}"
    user: "indievelopment"
    database: "indievelopment"
    alternative_names:
      - "indievelopment.nl"
      - "www.indievelopment.nl"
      - "indiedevelopment.nl"
      - "www.indiedevelopment.nl"
    state: "present"

  - name: "koala.{{ canonical_hostname }}"
    custom_config: true
    # Hostnames have to be set in custom nginx config as well!
    alternative_names:
      - "intro.{{ canonical_hostname }}"
      - "leden.{{ canonical_hostname }}"
      - "members.{{ canonical_hostname }}"
    # You have to remove the task include of koala.yml to remove this completely
    state: "present"

  - name: "metrics.{{ canonical_hostname }}"
    custom_config: true
    # Hostnames have to be set in custom nginx config as well!
    alternative_names:
      - "status.{{ canonical_hostname }}"
    # You have to remove the task include of monitoring.yml to remove this
    # completely
    state: "present"

  - name: "phpmyadmin.{{ canonical_hostname }}"
    custom_config: true
    database: "phpmyadmin"
    # Hostnames have to be set in custom nginx config as well!
    alternative_names:
      - "pma.{{ canonical_hostname }}"
    # You have to remove the task include of phpmyadmin.yml to remove this
    # completely
    state: "present"

  - name: "radio.{{ canonical_hostname }}"
    user: "commit"
    alternative_names: []
    state: "present"

  - name: "savadaba.{{ canonical_hostname }}"
    custom_config: true
    # Hostnames have to be set in custom nginx config as well!
    alternative_names:
      - "savadaba.nl"
      - "www.savadaba.nl"
    state: "present"

  - name: "sodi.{{ canonical_hostname }}"
    alternative_names:
      - "sodi.nl"
      - "www.sodi.nl"
    # You have to remove the task include of sodi.yml to remove this completely
    state: "present"

  - name: "stichting.{{ canonical_hostname }}"
    user: "stichting"
    alternative_names:
      - "stichtingsticky.nl"
      - "www.stichtingsticky.nl"
    state: "present"

  - name: "studytrip.{{ canonical_hostname }}"
    user: "studytrip"
    database: "studytrip"
    alternative_names:
      - "studiereis.{{ canonical_hostname }}"
    state: "present"

  - name: "{{ canonical_hostname }}"
    user: "commit"
    database: "svsticky"
    custom_config: true
    # Hostnames have to be set in custom nginx config as well!
    alternative_names:
      - "www.{{ canonical_hostname }}"
      - "stickyutrecht.nl"
      - "www.stickyutrecht.nl"
      - "studieverenigingsticky.nl"
      - "www.studieverenigingsticky.nl"
    state: "present"

  - name: "symposium.{{ canonical_hostname }}"
    user: "symposium"
    alternative_names:
      - "idata.{{ canonical_hostname }}"
    state: "present"

  - name: "wintersport.{{ canonical_hostname }}"
    user: "wintersport"
    alternative_names: []
    state: "present"

  - name: "execut.{{ canonical_hostname }}"
    user: "symposium"
    alternative_names:
      - "execut.nl"
      - "www.execut.nl"
    state: "present"

slacktee:
  repo: "https://github.com/course-hero/slacktee.git"
  install_path: "/usr/local/src/slacktee"

koala:
  environment:
    "{% if staging == 'true' %}staging{% else %}production{% endif %}"
  server: "unicorn" # or webrick
  # Change git-tag here to deploy new release in production
  git_ref: "{% if staging == 'true' %}development{% else %}v1.6.11{% endif %}"
  ruby_version: "2.4.1"
  threads: 8
  dependencies:
    - repo: "rbenv"
      install_path: "~/.rbenv"
    - repo: "ruby-build"
      install_path: "~/.rbenv/plugins/ruby-build"
    - repo: "rbenv-vars"
      install_path: "~/.rbenv/plugins/rbenv-vars"
