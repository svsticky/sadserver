---
- name: "remove old phpmyadmin webroot"
  file:
    path: "/var/www/phpmyadmin.{{ canonical_hostname }}"
    state: "absent"

- name: "install phpmyadmin dependencies"
  apt:
    name:
      - "php7.4-zip"
      - "php7.4-xml"
      - "php7.4-mbstring"
      - "php7.4-mysqli"
    state: "absent"

- name: "create phpmyadmin user"
  user:
    name: "phpmyadmin"
    home: "/var/www/phpmyadmin"
    shell: "/usr/sbin/nologin"
    system: true
    state: "absent"

- name: "create phpmyadmin webroot"
  file:
    path: "/var/www/phpmyadmin/phpmyadmin.{{ canonical_hostname }}"
    owner: "www-data"
    group: "phpmyadmin"
    mode: "2775"
    state: "absent"

- name: "remove fpm file"
  file:
    path: "/etc/php/7.4/fpm/pool.d/pool-phpmyadmin.{{ canonical_hostname }}.conf"
    state: "absent"
