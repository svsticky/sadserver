# Ansible managed

services:

  outline:
    build:
      dockerfile: Dockerfile
    env_file: ./docker.env
    restart: on-failure:3
    #    ports:
    #      - "4568:3000"
    network_mode: host # TODO replace this
    volumes:
      - storage-data:/var/lib/outline/data
        #    depends_on:
        #      - postgres
        #      - redis

        #  redis:
        #    image: redis
        #    env_file: ./docker.env
        #    ports:
        #      - "6379:6379"
        #    volumes:
        #      - ./redis.conf:/redis.conf
        #    command: ["redis-server", "/redis.conf"]
        #    healthcheck:
        #      test: ["CMD", "redis-cli", "ping"]
        #      interval: 10s
        #      timeout: 30s
        #      retries: 3

      #  postgres:
      #    image: postgres
      #    env_file: ./docker.env
      #    ports:
      #      - "5432:5432"
      #    volumes:
      #      - database-data:/var/lib/postgresql/data
      #    healthcheck:
      #      test: ["CMD", "pg_isready", "-d", "outline", "-U", "user"]
      #      interval: 30s
      #      timeout: 20s
      #      retries: 3
      #    environment:
      #      POSTGRES_USER: 'user'
      #      POSTGRES_PASSWORD: 'pass'
      #      POSTGRES_DB: 'outline'

volumes:
  storage-data:
  # database-data:
